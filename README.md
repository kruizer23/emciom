# emciom
[![License: GPL v3](https://img.shields.io/badge/License-GPLv3-blue.svg)](https://www.gnu.org/licenses/gpl-3.0)


e**mc**i**om** is a program that runs **m**ultiple **c**ommands and then sends the **o**utput via e-**m**ail.
The commands to run are read from a configuration file.


This program was developed for the specific use case where you have a GNU/Linux server and would like to receive
periodic e-mails with status information. The status information is generated by appending the output of
several commands that run on the server. 

Program features:

* Reads the commands to run from a configuration file.
* Supports command piping. 
* Allows the specification of a custom subject for the e-mail message.

## Installation

emciom is a single file Python 3 program called `emciom.py`. You can copy it to any location you prefer and
run it from there. The recommended approach is to copy it to `/usr/bin` and make sure the program is marked
as executable:

* `sudo cp emciom.py /usr/bin/emciom`
* `sudo chmod +x /usr/bin/emciom`

## Prerequisites

It is assumed that a mail transfer agent such as [Postfix](http://www.postfix.org/) is installed on the
sytem to handle the actual sending of the e-mail message.

## Usage

The first step is to create the configuration file and store it at the default location where the program
expects it. Note that it is also possible to have the configuration file located somewhere else, by
specifying its location with the `-cf <file>` parameter on the command-line.

* `sudo mkdir -p /etc/emciom`
* `sudo nano /etc/emciom/emciom.conf`

Simply list each command to run on a new line, for example:

```
uptime
df -h
ip addr | head -6
```

Once the configuration file is in place, you can run the program by specificing the recipient and sender 
e-mail addresses on the command line:

* `emciom to@domain.com from@domain.com`

Example e-mail message that was sent:

```
Subject:   Message from emciom
From:      from@domain.com
To:        to@domain.com
Contents:

================================================================================
Command: uptime
--------------------------------------------------------------------------------
22:25:11 up 1 day, 5:01, 1 user, load average: 0.00, 0.00, 0.00
================================================================================

================================================================================
Command: df -h
--------------------------------------------------------------------------------
Filesystem Size Used Avail Use% Mounted on
udev 7.8G 0 7.8G 0% /dev
tmpfs 1.6G 11M 1.6G 1% /run
/dev/sda1 41G 1.5G 37G 4% /
tmpfs 7.8G 0 7.8G 0% /dev/shm
tmpfs 5.0M 0 5.0M 0% /run/lock
tmpfs 7.8G 0 7.8G 0% /sys/fs/cgroup
/dev/md0 449G 165G 261G 39% /home
tmpfs 1.6G 0 1.6G 0% /run/user/1000
================================================================================

================================================================================
Command: ip addr | head -6
--------------------------------------------------------------------------------
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
inet 127.0.0.1/8 scope host lo
valid_lft forever preferred_lft forever
inet6 ::1/128 scope host
valid_lft forever preferred_lft forever
================================================================================
```

If it is preferred to run emciom periodically, this can be automated by creating a CRON job. Example
for a daily CRON job on Debian/Ubuntu based systems:

* Create and edit the file `/etc/cron.d/emciomdaily` such that it has the following contents, but update
  the parameters for you situation:
    ```
    # run at 1:23am every day
    23 01 * * * root emciom to@domain.com from@domain.com >>/var/log/emciomrun 2>&1
    ```
* Restart the CRON daemon to make sure the new CRON job is active: `sudo systemctl restart cron`.

### Additional help

For additional details on emciom, run the program with the `--help` parameter:

```
usage: emciom [-h] [-d] [-es EMAIL_SUBJECT] [-cf CONFIG_FILE]
              recipient sender

A program for running multiple commands, capturing their outputs, and sending
the combined outputs by e-mail. The commands to run are listed on each line
in /etc/emciom/emciom.conf.

positional arguments:
  recipient          e-mail address to send the message to.
  sender             e-mail address of the sender.

optional arguments:
  -h, --help         show this help message and exit
  -d, --debug        enable debug messages on the standard output.
  -es EMAIL_SUBJECT  subject of the e-mail message.
  -cf CONFIG_FILE    Non-default configuration file to use.
```

